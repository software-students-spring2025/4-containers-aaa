<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ entry.title }} - Details</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="second-container">
    <h1>{{ entry.title }}</h1>
    <div class = "basic-info-w-edit-button">
      <div class = "basic-info">
        <p><strong>Speaker:</strong> {{ entry.speaker }}</p>
        <p><strong>Date:</strong> {{ entry.date }}</p>
        <p><strong>Description:</strong> {{ entry.context }}</p>
      </div>
      <div class="edit-container">
        <div style="margin-top: 1.5rem;">
          <a href="{{ url_for('edit_entry', file_path=entry._id) }}" class="cancel-button">✏️ Edit Entry</a>
        </div>
      </div>
    </div>

    <p class="second-p"><strong>Transcript:</strong></p>
    <pre class="transcript-box">{{ entry.transcript }}</pre>

    <p><strong>Word Count:</strong> {{ entry.word_count }}</p>

    {% if entry.top_words %}
      <p><strong>Most Frequently Used 10 Words:</strong></p>
      <div style="max-width: 600px; height: 400px; margin: 0 auto;">
        <canvas id="topWordsChart"></canvas>
      </div>
    {% else %}
      <p><strong>Most Frequently Used 10 Words:</strong> <em>No frequent words available.</em></p>
    {% endif %}
    <p style="font-style: italic;">(Stop words and words appeared less than twice are removed here.)</p>

    {% if entry.audio_file %}
      <p style="margin-top: 2rem;"><strong>Audio:</strong></p>
      <audio controls style="width: 100%; margin-top: 1px;">
        <source src="{{ url_for('static', filename='uploaded_audio/' + entry.audio_file.split('/')[-1]) }}" type="audio/mpeg">
        Your browser does not support the audio tag.
      </audio>
    {% endif %}

    <div style="margin-top: 1.5rem;">
      <a href="{{ url_for('index') }}" class="cancel-button">← Back to List</a>
    </div>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  {% if entry.top_words %}
  <script>
    const topWords = {{ entry.top_words[:10] | tojson }};
    const labels = topWords.map(pair => pair[0]);
    const counts = topWords.map(pair => pair[1]);

    const ctx = document.getElementById('topWordsChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Top Words',
          data: counts,
          backgroundColor: 'rgba(204, 153, 255, 0.7)', 
          borderWidth: 1,
          borderRadius: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: {
            ticks: { 
              color: '#dedede',
              font: {
                family: 'Arial',
                size: 14,
                weight: 'bold'
              }
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: '#dedede',
              stepSize: 1,
              precision: 0,
              font: {
                family: 'Arial',
                size: 14,
                weight: 'bold'
              }
            }
          }
        }
      }
    });
    window.addEventListener('scroll', function() {
      const scrollY = window.scrollY;
      document.body.style.backgroundPosition = `0 ${scrollY * 0.5}px, 0 ${100 + (scrollY * 0.5)}px`;
    });
  </script>

  {% endif %}
</body>
</html>